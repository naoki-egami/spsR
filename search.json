[{"path":"http://naokiegami.com/spsR/articles/faq.html","id":"table-of-contents","dir":"Articles","previous_headings":"","what":"Table of Contents","title":"Frequently Asked Questions","text":"[Introduction] [Example: Multi-Country Survey Experiment] [sps: Site Selection] [sps_estimator: Estimate Average-Site ATE]","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":[]},{"path":"http://naokiegami.com/spsR/articles/intro.html","id":"over","dir":"Articles","previous_headings":"","what":"1.  Overview","title":"Introduction to SPS","text":"External validity causal findings focus long-standing debates. Whether can researchers generalize causal findings across different contexts settings? address question, increasing number researchers use multi-site/multi-context design researchers conduct causal studies multiple sites compare aggregate findings across contexts. designing multi-site experiments (observational studies), fundamental research design question select study sites external validity? R package spsR aims help researchers select sites external validity statistical foundation, accommodating practical logistical constraints. particular, spsR implements Synthetic Purposive Sampling (SPS) introduced Egami Lee (2023+), improves upon conventional purposive sampling combining ideas synthetic control method — selects diverse sites non-selected sites well approximated weighted average selected sites. , even without random sampling, can make weighted average selected sites representative sites, including non-selected sites population sites. Please read Egami Lee (2023+) methodological details. Using spsR, researchers can Select diverse sites based SPS framework Estimate average causal effect population sites","code":""},{"path":"http://naokiegami.com/spsR/articles/intro.html","id":"example","dir":"Articles","previous_headings":"","what":"2.  Example: Multi-Country Survey Experiment","title":"Introduction to SPS","text":"use multi-country survey experiment attitudes toward immigrants (Naumann et al., 2018) example . study aims answer long-standing question immigration literature—whether much natives prefer highly skilled migrants low skilled migrants? , site, conduct survey experiment randomly varied skill level hypothetical immigrant groups, .e., “professionals” “unskilled labors” (treatment variable), asked respondents report support level immigrant group (outcome variable). example, try select 6 countries 15 European countries study sites multi-site survey experiment. selecting study sites multi-site experiments, choose site-level variables want diversify. example, understand whether causal findings vary across different contexts, researchers might include diverse countries different GDP, size migrant population, unemployment rates, . formally, researchers choose site-level variables predict across-site heterogeneity causal effects. illustration, consider 8 variables discussed original paper: GDP (GDP), unemployment rates (Unemployment), size migrant population (Immigration), proportion females (Female), mean age (Age), mean education (Education), general support immigration (Immig_Support), sub-regions Europe (Eastern Europe, Northern Europe, Southern Europe, Western Europe). practice, recommended standardize continuous variable make scale site-level variables comparable. , variable mean zero standard deviation one. Users can use sps_plot() visualize distribution site-level variables site selection. select first several variables continuous.","code":"library(spsR) data(\"X_Imm\") colnames(X_Imm) ##  [1] \"GDP\"             \"Unemployment\"    \"Immigration\"     \"Female\"          ##  [5] \"Age\"             \"Education\"       \"Immig_Support\"   \"Eastern Europe\"  ##  [9] \"Northern Europe\" \"Southern Europe\" \"Western Europe\" var_cont <-  c('GDP', 'Unemployment', 'Immigration',                 'Female', 'Age', 'Education', 'Immig_Support') X_Imm[, var_cont] <- scale(X_Imm[, var_cont]) round(head(X_Imm), 3) ##                GDP Unemployment Immigration Female    Age Education ## Austria     -0.528       -0.511       0.698 -0.029  0.032    -1.747 ## Belgium     -0.453        0.117      -0.202 -0.615 -1.019     0.522 ## Switzerland -0.236       -0.720       2.769 -0.927 -0.734    -0.669 ## Czechia     -0.710       -0.663      -1.668  0.672 -1.446     0.170 ## Germany      2.259       -0.761       0.249 -0.661  0.396     0.288 ## Denmark     -0.602       -0.384      -0.582 -1.306 -0.581     0.609 ##             Immig_Support Eastern Europe Northern Europe Southern Europe ## Austria            -0.664              0               0               0 ## Belgium            -0.226              0               0               0 ## Switzerland         0.530              0               0               0 ## Czechia            -2.276              1               0               0 ## Germany             1.158              0               0               0 ## Denmark             0.444              0               1               0 ##             Western Europe ## Austria                  1 ## Belgium                  1 ## Switzerland              1 ## Czechia                  0 ## Germany                  1 ## Denmark                  0 sps_plot(X = X_Imm, before_selection = TRUE, columns = var_cont)"},{"path":"http://naokiegami.com/spsR/articles/intro.html","id":"sps","dir":"Articles","previous_headings":"","what":"3.  sps: Site Selection","title":"Introduction to SPS","text":"can use sps() select 6 sites 15 European countries (population sites). start basic version sps illustrate refinements next. Arguments X: Site-level variables population sites. Row names names sites. N_s: Number study sites selected. example, sps selected following 6 sites. Users can investigate selected sites visually using sps_plot().  Red triangles represent selected sites black circles represent non-selected sites. last row diagonal plots, users can see marginal distribution variable. remaining figures middle show bivariate relationships two variables. can see selected sites successfully cover wide range values site-level variable. necessary, users can refine site selection using stratification make sure selected sites satisfy certain conditions. stratification can help users incorporate various practical, logistical, ethical constraints. See examples . practice, researchers might want stratify variables make sure study sites satisfy certain conditions.","code":"out <- sps(X = X_Imm, N_s = 6) ## Selecting Study Sites... out$selected_sites ## [1] \"Switzerland\" \"Czechia\"     \"Germany\"     \"Denmark\"     \"Spain\"       ## [6] \"Netherlands\" sps_plot(out, columns = var_cont)"},{"path":"http://naokiegami.com/spsR/articles/intro.html","id":"example-1-improve-diversity-of-site-level-variables","dir":"Articles","previous_headings":"3.  sps: Site Selection","what":"Example 1: Improve Diversity of Site-Level Variables","title":"Introduction to SPS","text":"often useful select sites high, middle, low values site-level variables. example, users might want make sure select least one country low, medium, high GDP countries. Users can enforce condition using stratify_sps(). select countries high GDP, might want select least 2 sites GDP larger equal 0.5 (.e., 0.5 standard deviation standardized ). can incorporate information follows. select countries medium GDP, might want select least 2 sites GDP c(-0.25, 0.25) (.e., -0.25 0.25 standard deviation). Finally, select countries low GDP, might want select least 2 sites GDP smaller equal -0.5 (.e., -0.5 standard deviation). Arguments num_site: list two elements, e.g., list(\"least\", 1). argument specifies number sites satisfy condition specified . first element either least . second element integer. example, list(\"least\", 1) means stratify SPS select least 1 site satisfies condition (specified ). condition: list three elements, e.g., list(\"GDP\", \"larger equal \", 1). argument specifies conditions stratification. first element name site-level variable. second element either larger equal , smaller equal , . third element vector length 1 2. second element , third element vector two values. example, list(\"GDP\", \"larger equal \", 1) means stratify SPS select num_site sites GDP larger equal 1. specifying staratification, researchers can supply sps(). Arguments stratify: list element output function stratify_sps().","code":"st_GDP_1 <- stratify_sps(X = X_Imm,                           num_site=list(\"at least\", 2),                           condition=list(\"GDP\", \"larger than or equal to\", 0.5)) ## 3 sites satisfy the specified `condition` and sps() will select at least 2 sites from them. st_GDP_2 <- stratify_sps(X = X_Imm,                           num_site=list(\"at least\", 2),                           condition=list(\"GDP\", \"between\", c(-0.25, 0.25))) ## 3 sites satisfy the specified `condition` and sps() will select at least 2 sites from them. st_GDP_3 <- stratify_sps(X = X_Imm,                           num_site=list(\"at least\", 2),                           condition=list(\"GDP\", \"smaller than or equal to\", -0.5)) ## 7 sites satisfy the specified `condition` and sps() will select at least 2 sites from them. out_GDP <- sps(X = X_Imm,                 N_s = 6,                 stratify = list(st_GDP_1, st_GDP_2, st_GDP_3)) ## Selecting Study Sites... out_GDP$selected_sites ## [1] \"Switzerland\"    \"Czechia\"        \"Denmark\"        \"Spain\"          ## [5] \"France\"         \"United Kingdom\""},{"path":"http://naokiegami.com/spsR/articles/intro.html","id":"example-2-select-countries-from-each-sub-region","dir":"Articles","previous_headings":"3.  sps: Site Selection","what":"Example 2: Select Countries from Each Sub-Region","title":"Introduction to SPS","text":"often useful select sites different subgroups. example, users might want make sure select least one country 4 sub-regions Europe. following code ensures select least 1 site countries Northern Europe = 1. Similarly, following codes ensure select least 1 site countries Eastern Europe = 1, Western Europe = 1 Southern Europe = 1, respectively. Finally, users combine one list supply function sps(). Please see Stratified SPS practical recommendations stratification.","code":"st_NE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Northern Europe\", \"larger than or equal to\", 1)) ## 6 sites satisfy the specified `condition` and sps() will select at least 1 site from them. st_EE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Eastern Europe\", \"larger than or equal to\", 1)) ## 1 site satisfies the specified `condition` and sps() will select at least 1 site from them. st_WE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Western Europe\", \"larger than or equal to\", 1)) ## 6 sites satisfy the specified `condition` and sps() will select at least 1 site from them. st_SE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Southern Europe\", \"larger than or equal to\", 1)) ## 2 sites satisfy the specified `condition` and sps() will select at least 1 site from them. out_region <- sps(X = X_Imm,                    N_s = 6,                    stratify = list(st_NE, st_EE, st_WE, st_SE)) ## Selecting Study Sites... out_region$selected_sites ## [1] \"Switzerland\" \"Czechia\"     \"Germany\"     \"Denmark\"     \"Spain\"       ## [6] \"Netherlands\""},{"path":"http://naokiegami.com/spsR/articles/intro.html","id":"sps_estimator","dir":"Articles","previous_headings":"","what":"4.  sps_estimator: Estimate the Average-Site ATE","title":"Introduction to SPS","text":"complete randomized experiment (internally valid observational study) site, now aggregate evidece external validity. sps_estimator() aggregate estimates average treatment effects (ATEs) specific site order estimate average-site ATE (average ATEs population sites). example, average-site ATE average ATEs across 15 European countries, including countries selected. start ATE estimates selected sites. use experimental estimates selected 6 sites Naumann et al (2018). Users need obtain point estimates standard errors average treatment effects (ATEs) site. example, use selected sites . external validity analysis, aggregate site-specific ATEs selected sites estimate average-site ATE. Arguments : Output function sps() estimates_selected: data.frame two columns: first column represents estimates site-specific ATEs selected sites second column represents corresponding standard error. number rows equal number selected sites rownames(estimates_selected) names selected sites. can check results using summary function. can also visualize site-specific ATEs average-site ATE together using plot().  Finally, users can use site-level cross-validation assess influence unobserved moderators. particular, users can randomly choose half selected sites unobserved non-selected sites predict average ATE non-selected sites based remaining selected sites. null hypothesis predicted ATEs observed ATEs. example, estimated p-value 0.94, find evidence bias due unobserved moderators.","code":"data(\"exp_estimate_Imm_selected\") exp_estimate_Imm_selected ##              Estimate Std. Error ## Netherlands 0.3034004 0.02294807 ## Germany     0.3362153 0.01635270 ## Denmark     0.2936739 0.02520817 ## Spain       0.2831690 0.02368973 ## Switzerland 0.2857338 0.02715871 ## Czechia     0.2210802 0.01993582 sps_est <- sps_estimator(out = out,                           estimates_selected = exp_estimate_Imm_selected)  sps_est2 <- sps_estimator(X = out$internal$X, estimates_selected = exp_estimate_Imm_selected,                            selected_sites = sort(unique(out$selected_sites))) summary(sps_est) ##  ##   Estimate Std. Error  CI Lower  CI Upper p value     ##  0.2888706 0.01957847 0.2504975 0.3272437       0 *** ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 summary(sps_est2) ##  ##   Estimate Std. Error  CI Lower  CI Upper p value     ##  0.2888706 0.01957847 0.2504975 0.3272437       0 *** ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 summary(sps_est) ##  ##   Estimate Std. Error  CI Lower  CI Upper p value     ##  0.2888706 0.01957847 0.2504975 0.3272437       0 *** ## --- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 plot(sps_est) sps_cv_out <- sps_cv(out = out, estimates_selected = exp_estimate_Imm_selected) round(sps_cv_out$p_value, 2) ## [1] 0.94"},{"path":[]},{"path":"http://naokiegami.com/spsR/articles/missing_data.html","id":"example-impute-missing-values-with-impute_var","dir":"Articles","previous_headings":"","what":"Example: Impute Missing Values with impute_var","title":"Handle Missing Data","text":"Please first install R package spsRdata. , call R package spsRdata. impute_var R package spsRdata imputes missing values continuous categorical variables. Categorical variables (character factor) converted dummies unique value prior imputation. data set can either cross-sectional time-series cross-sectional. , demonstrate utility impute_var using country-level data set sps_country_data, impute_var can handle type data set. example, impute two variables, Polity score (e_p_polity) GDP (NY.GDP.MKTP.CD), missing values. impute two variables using amelia. specifying id_site id_time, function impute_var can respect time-series cross-sectional data structure. specify id_site, underlying imputation method assumes cross-sectional data. Arguments data: data.frame containing variables impute. id_site: unique identifier sites. column name data. id_time: unique identifier time index. column name data. unspecified (NULL; default), assumes data cross-sectional. var_impute: vector one variable names imputation performed. unspecified (NULL), imputes variables data except id_site id_time variables. var_ord: (Optional) vector names ordinal variables var_impute. Binary variables can included either var_ord var_nom. var_nom: (Optional) vector names nominal variables (non-ordinal categorical variables) var_impute. var_lgstc: (Optional) vector names proportional variables (ranges 0 1) var_impute. var_predictor: vector one variable names use predictors impute variables var_impute. unspecified (NULL), function uses variables data except variables var_impute. method: Imputation method. Choose amelia, mice miceranger. Default amelia. n_impute: number imputed data sets produce (equivalent argument m amelia() miceRanger()). Default 5. ...: Arguments passed onto Amelia::amelia() mice::mice() miceRanger::miceRanger(). Imputation Methods Amelia. Please read Honaker, King, Blackwell (2011) details. MICE. Please read Van Buuren Groothuis-Oudshoorn (2011) details. MICERanger. Please read Wilson (2020) details.","code":"library(devtools) if(!require(spsRdata)) install_github(\"naoki-egami/spsRdata\", dependencies = TRUE) library(spsRdata) data(sps_country_data) apply(sps_country_data[, c('e_p_polity', 'NY.GDP.MKTP.CD')], 2, function(x) sum(is.na(x))) ##     e_p_polity NY.GDP.MKTP.CD  ##            822            107 imputed_data <- impute_var(data = sps_country_data,                             id_unit = 'country',                             id_time = 'year',                             var_impute = c('e_p_polity', 'NY.GDP.MKTP.CD'),                            var_ord = 'e_p_polity',                            method = \"amelia\") apply(imputed_data[, c('e_p_polity', 'NY.GDP.MKTP.CD')], 2, function(x) sum(is.na(x))) ##     e_p_polity NY.GDP.MKTP.CD  ##              0              0"},{"path":"http://naokiegami.com/spsR/articles/missing_data.html","id":"practical-suggestions","dir":"Articles","previous_headings":"Example: Impute Missing Values with impute_var","what":"Practical Suggestions","title":"Handle Missing Data","text":"Missing data imputation works better users supply variables observations underlying method can learn relationships different variables better. Therefore, practice, recommend imputing missing data first sub-setting data target population sites site-level variables diversify. example, users want use sps_country_data provide spsRdata, can impute missing data first using full data subset data focus target population sites site-level variables interest.","code":""},{"path":"http://naokiegami.com/spsR/articles/missing_data.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Handle Missing Data","text":"Honaker, J., King, G., & Blackwell, M. (2011). Amelia II: program missing data. Journal statistical software, 45, 1-47. King, G., Honaker, J., Joseph, ., & Scheve, K. (2001). Analyzing incomplete political science data: alternative algorithm multiple imputation. American political science review, 95(1), 49-69. Van Buuren, S., & Groothuis-Oudshoorn, K. (2011). mice: Multivariate imputation chained equations R. Journal statistical software, 45, 1-67. Wilson, S. (2020). miceRanger: Multiple imputation chained equations random forests. R package version, 1(5).","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"step","dir":"Articles","previous_headings":"","what":"1.  Step by Step Instruction","title":"Practical Guides","text":", summarize step step instructions use spsR package (1) select study sites (2) estimate average-site average treatment effect (average-site ATE).","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"site-selection-via-synthetic-purposive-sampling","dir":"Articles","previous_headings":"1.  Step by Step Instruction","what":"1.1  Site Selection via Synthetic Purposive Sampling","title":"Practical Guides","text":"can select study sites external validity? recommended choose contextual moderators predict differences ATEs across sites. step researchers already implicitly diversifying one two variables hand practice. SPS, users can incorporate covariates expected moderate ATEs across sites (instead just one two variables). example, example Get Started Page, chose 7 variables discussed original paper: GDP, size migrant population, unemployment rates, general support immigration, proportion females, mean age, mean education. recommend including many irrelevant variables SPS might decrease balance key variables improve balance irrelevant variables. concern unobserved site-level variables, recommended include proxies unobserved variables, feasible. diversifying observed proxies associated unobserved variables, SPS can often mitigate potential influence unobserved variables. Please also see Common Questions Concerns learn handle unmeasured confounders. collecting site-level variables (see recommendations Prepare Site-Level Varaibles), users can run function sps() optimally diversify chosen site-level variables. Please see Get Started Page implementation. recommended stratify key site-level variables using function stratify_sps(). stratification can allow users impose certain conditions site selection. example, researchers can make sure select least one country region world. Researchers can also incorporate domain knowledge practical constraints SPS. example, users might able run experiments certain countries covered online survey firms. Users might want include certain sites provide hard test given theory. Please see Stratified SPS different examples stratification.","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"analyze","dir":"Articles","previous_headings":"1.  Step by Step Instruction","what":"1.2  Analyzing Multi-Site Causal Studies","title":"Practical Guides","text":"complete studies (e.g., randomized experiments) selected study, can aggregate evidence external validity analysis? Users can first report internal validity analyses, focusing causal estimates within selected sites. purpose, researchers can use whatever estimator like use estimate ATEs site, e.g., difference--means linear regression estimators. SPS selected diverse sites, researchers can investigate causal estimates vary across diverse contexts. Researchers can use function sps_estimator() estimate average-site ATE test whether causal findings selected sites generalize broader population sites. practice, researchers can use plot(sps_est) visualize site-specific ATEs average-site ATE together. sps_est output sps_estimator(). Please see Get Started Page implementation. Finally, empirically test potential influence unobserved site-level variables, researchers can conduct site-level cross-validation using function sps_cv(). Please see Get Started Page implementation. function, randomly choose half selected sites unobserved non-selected sites predict average ATE non-selected sites based remaining selected sites. repeating procedure many times, researchers can empirically check well SPS estimator can credibly infer ATEs non-selected sites. users pass test, evidence significant bias unobserved site-level variables, researchers can never confirm usual statistical tests. users fail test, implies large across-site heterogeneity, explained site-level variables. view opportunity research (rather failure given multi-site causal study) shows remains large amount across-site heterogeneity existing theories account . scenarios, researchers can consider sequential learning: rather viewing current study final confirmation, researchers suggest new study sequentially applying SPS.","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"question","dir":"Articles","previous_headings":"","what":"2.  Common Questions and Concerns","title":"Practical Guides","text":"Researchers might worried potential influence unobserved moderators. clarify several points reason unobserved moderators. Compared current practice purposive sampling, researchers often focus one two variables, concern mitigated SPS users can include number site-level moderators based domain theoretical knowledge. Diversifying observed site-level variables can often help diversify even unobserved site-level variables many key site-level variables correlated. addition, unobserved variables independent observed site-level variables, lead unobserved bias distribution unobserved variables selected non-selected sites, select sites based observed variables. Therefore, SPS make potential influence unobserved moderators bigger diversifying observed site-level variables somehow reduces diversity unobserved site-level variables, requires users believe complicated nonlinear relationships observed unobserved site-level variables. diversifying observed site-level variables can often diversify unobserved site-level variables, always recommended empirically assess influence unobserved moderators using site-level cross-validation using function sps_cv() (see third step Section 1.2 Analyzing Multi-Site Causal Studies). Finally, SPS focuses mean squared error assume absence unobserved moderators, theoretical guarantees valid even exist unobserved moderators. SPS algorithm can reduce mean squared error users can include predictive moderators, unobserved moderators invalidate use SPS. Please see Section 5.3 Egami Lee (2023+) theoretical foundation. Example 1: wanted select diverse countries high, middle, low GDP countries, SPS algorithm select country top 20 percentile GDP distribution select high GDP country. Example 2: wanted select diverse countries sub-region Europe, SPS algorithm select country Southern Europe -sampled Northern Europe. Without instruction, sps() might perfectly diversify variables wish function achieve diversity variables make trade-. users want achieve specific conditions, researchers can directly enforce conditions sps() using stratification via function stratify_sps(). Solution Example 1: Researchers can use stratify_sps() make sure sps() select least one country top 20 percentile GDP distribution. Solution Example 2: Researchers can use stratify_sps() make sure sps() select least one country Southern Northern Europe, respectively. Please see Stratified SPS learn use stratification improve diversity include practical constraints domain knowledge SPS algorithm. random sampling feasible number sites sampled relatively large, recommended rely random sampling. However, many social science settings, random sampling infeasible (see literature review Egami Lee (2023+)). proposed SPS complementary random sampling useful random sampling infeasible.","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"prepare","dir":"Articles","previous_headings":"","what":"3.  Prepare Site-Level Variables","title":"Practical Guides","text":"practice, users need prepare site-level variables population sites using functions spsR package. offer practical guides ease data collection.","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"prepare-country","dir":"Articles","previous_headings":"3.  Prepare Site-Level Variables","what":"3.1.  Country-Level Variables","title":"Practical Guides","text":"users considering multi-site experiments sites countries, offer companion R package spsRdata, contains default country-level data set (sps_country_data) contains wide range commonly used country-level data easy--use functions merge variables variety common data sets (e.g., V-Dem World Bank) See Prepare Country-Level Data.","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"prepare-us","dir":"Articles","previous_headings":"3.  Prepare Site-Level Variables","what":"3.2.  State- or City-Level Variables in the US","title":"Practical Guides","text":"considering multi-site experiments sites states cities US, following data sources might useful. National Historical Geographic Information System (NHGIS): https://www.nhgis.org/ Census Governments: https://www.census.gov/programs-surveys/cog.html U.S. Bureau Labor Statistics: https://www.bls.gov/ Federal Bureau Investigation: https://cde.ucr.cjis.gov/LATEST/webapp/#/pages/home","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"missing","dir":"Articles","previous_headings":"3.  Prepare Site-Level Variables","what":"3.3.  How to Handle Missing Data","title":"Practical Guides","text":"collect site-level variables, might find missing data. handle missing data easily, offer function impute_var() R package spsRdata impute missing data based state---art missing data imputation methods. Please see Handle Missing Data. imputing missing data, users can run sps().","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"useful","dir":"Articles","previous_headings":"","what":"4.  Useful Information for Multi-Country Survey Experiments","title":"Practical Guides","text":"political science, one popular types multi-site experiments multi-country survey experiment. offer practical guides ease implementation multi-country survey experiments.","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"firms","dir":"Articles","previous_headings":"4.  Useful Information for Multi-Country Survey Experiments","what":"4.1.  Survey Firms","title":"Practical Guides","text":"following survey firms offer service many countries across world. Cint (Lucid): https://www.cint.com/consumer-insights-exchange YouGov: https://business.yougov.com/product/realtime/international-omnibus Dynata: https://www.dynata.com/market-researcher-solutions/global-audiences","code":""},{"path":"http://naokiegami.com/spsR/articles/practical_guides.html","id":"translation","dir":"Articles","previous_headings":"4.  Useful Information for Multi-Country Survey Experiments","what":"4.2.  Translation of Survey Experiments","title":"Practical Guides","text":"easier translate survey experiments different languages ever . Qualtrics: https://www.qualtrics.com/support/survey-platform/survey-module/survey-tools/translate-survey/ Gengo.com: https://gengo.com","code":""},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"over","dir":"Articles","previous_headings":"","what":"1.  Overview","title":"Prepare Country-Level Variables","text":"purpose R package spsRdata facilitate data collection multi-country studies. Users can supply data prepared page function sps() site selection. Users can start default data set sps_country_data contains wide range commonly-used country-level variables social sciences. R package spsRdata also offers several functions merge additional country-level variables well-known data sets (e.g., V-Dem World Bank) well external data users want add. Note: emphasize R package sps corresponding SPS algorithm can applied type study site (e.g., states, districts, villages, schools). multi-country studies popular political science, R package spsRdata focuses country-level data collection now, planning add functionalities facilitate data collection different levels (e.g., states cities) US well.","code":""},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"default","dir":"Articles","previous_headings":"","what":"2.  Default Country-Level Data set","title":"Prepare Country-Level Variables","text":"Please first install R package spsRdata. , call R packages spsR spsRdata. R package spsRdata, provide country-level data set (sps_country_data) comprised 22 variables 179 countries 2010 2022. contains wide range variables commonly used social sciences: represent political, economic, social characteristics countries. variables collected following sources. V-Dem data set collects variables variety sources including United Nations, Quality Government, Clio Infra, Polity5 Project, currently includes comprehensive political indicators. World Bank Indicators UN Statistics University Groningen’s World Languages sps_country_data includes following variables. Descriptions Variables: Users can check codebook using data(sps_country_codebook).","code":"library(devtools) if(!require(spsRdata)) install_github(\"naoki-egami/spsRdata\", dependencies = TRUE) library(spsR) library(spsRdata) data(sps_country_data) head(sps_country_data, n = 3) ##   country iso3 year   region       subregion AG.LND.TOTL.K2 e_p_polity v2x_libdem v2x_polyarchy v2x_elecreg v2x_corr v2x_divparctrl v2x_gender v2x_rule v2x_ex_military SL.UEM.TOTL.ZS NY.GDP.MKTP.CD    lang SP.POP.TOTL SE.PRM.CUAT.ZS v2x_civlib v2xpe_exlsocgr ## 1  Mexico  MEX 2010 Americas Central America        1943950          8      0.459         0.649           1    0.637         -1.567      0.745    0.581           0.071           5.30   1.057801e+12 Spanish   112532401       74.74190      0.688          0.538 ## 2  Mexico  MEX 2011 Americas Central America        1943950          8      0.457         0.647           1    0.637         -1.567      0.746    0.581           0.071           5.17   1.180487e+12 Spanish   114150481             NA      0.687          0.538 ## 3  Mexico  MEX 2012 Americas Central America        1943950          8      0.449         0.645           1    0.662         -1.454      0.761    0.562           0.071           4.89   1.201094e+12 Spanish   115755909       77.18234      0.694          0.538 data(sps_country_codebook) sps_country_codebook[sps_country_codebook$Variable %in%                         c(\"country\", \"year\", \"NY.GDP.MKTP.CD\", \"SP.POP.TOTL\"), ] ##          Variable                                                  Description                          Scale    Coverage     Source ## 1         country Country name used by V-Dem (original variable: country_name)                           Text 2010 - 2022      V-Dem ## 3            year                           Year coded annually from 1789-2022         Integer (1789 to 2022) 2010 - 2022      V-Dem ## 17 NY.GDP.MKTP.CD                                                          GDP Continuous (current US dollar) 2010 - 2022 World Bank ## 19    SP.POP.TOTL                                             Total population                     Continuous 2010 - 2022 World Bank"},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"own","dir":"Articles","previous_headings":"","what":"3.  Prepare Your Own Country-Level Data","title":"Prepare Country-Level Variables","text":"follow example Get Started Page use multi-country survey experiment Naumann et al. (2018) illustrate use sps_country_data various functions spsRdata.","code":""},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"start","dir":"Articles","previous_headings":"3.  Prepare Your Own Country-Level Data","what":"3.1  Start with sps_country_data","title":"Prepare Country-Level Variables","text":"example, interested 8 country-level variables discussed original paper: GDP, unemployment rates, size migrant population, general support immigration, proportion female, mean age, mean education, sub-regions Europe. illustrate collect variables step step. interested 15 European countries variables measured 2015 (year Naumann et al (2018)’s experiments conducted). users running experiments now, can, course, choose site-level variables measured recent years. Three 8 variables already default data set: sub-regions (subregion), GDP (NY.GDP.MKTP.CD) unemployment rate (SL.UNEM.TOTL.ZS). subset data set include variables ’re interested .","code":"country_use <- c(\"Austria\", \"Belgium\", \"Czechia\", \"Denmark\", \"Finland\",                   \"France\", \"Germany\", \"Ireland\",\"Netherlands\", \"Norway\",                   \"Slovenia\", \"Spain\", \"Sweden\", \"Switzerland\", \"United Kingdom\")  sps_country_data1 <-    sps_country_data[sps_country_data$year == 2015 &                       sps_country_data$country %in% country_use,] sps_country_data2 <- sps_country_data1[, c(\"country\", \"iso3\",                                             \"subregion\", \"year\",                                             \"NY.GDP.MKTP.CD\", \"SL.UEM.TOTL.ZS\")]"},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"v-dem","dir":"Articles","previous_headings":"3.  Prepare Your Own Country-Level Data","what":"3.2  Merge Country-Level Variables from V-Dem or World Bank Data Sets","title":"Prepare Country-Level Variables","text":"Users can also search country-level variables V-Dem World Bank using keywords via function search_sps_data. , look data size migrant population: Based search return, users can add variable(s) baseline data set using merge_sps_data. example, ’re interested adding SM.POP.TOTL.ZS captures proportion migrant population. Arguments data: data.frame new variables merged onto. vars: vector one variable names merged onto data. merge variables V-Dem World Bank data sets (use search_sps_data() search names new variables).","code":"search_result <- search_sps_data(keyword = \"international migrant\") head(search_result, n = 3) ## # A tibble: 3 × 5 ##   Variable          Name                                               Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Coverage Source ##   <chr>             <chr>                                              <chr>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             <chr>    <chr>  ## 1 SG.POP.MIGR.FE.ZS Female migrants (% of international migrant stock) Percentage of female migrants out of total international migrant stock. International migrant stock is the number of people born in a country other than that in which they live. It also includes refugees.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Annual   World… ## 2 SM.POP.TOTL       International migrant stock, total                 International migrant stock is the number of people born in a country other than that in which they live. It also includes refugees. The data used to estimate the international migrant stock at a particular time are obtained mainly from population censuses. The estimates are derived from the data on foreign-born population--people who have residence in one country but were born in another country. When data on the foreign-born population are not available, data on foreign population--that is, people who are citizens of a country other than the country in which they reside--are used as estimates. After the breakup of the Soviet Union in 1991 people living in one of the newly independent countries who were born in another were classified as international migrants. Estimates of migrant stock in the newly independent states from 1990 on are based on the 1989 census of the Soviet Union. For countries wit… Annual   World… ## 3 SM.POP.TOTL.ZS    International migrant stock (% of population)      International migrant stock is the number of people born in a country other than that in which they live. It also includes refugees. The data used to estimate the international migrant stock at a particular time are obtained mainly from population censuses. The estimates are derived from the data on foreign-born population--people who have residence in one country but were born in another country. When data on the foreign-born population are not available, data on foreign population--that is, people who are citizens of a country other than the country in which they reside--are used as estimates. After the breakup of the Soviet Union in 1991 people living in one of the newly independent countries who were born in another were classified as international migrants. Estimates of migrant stock in the newly independent states from 1990 on are based on the 1989 census of the Soviet Union. For countries wit… Annual   World… sps_country_data3 <- merge_sps_data(data = sps_country_data2,                                      vars = c(\"SM.POP.TOTL.ZS\")) head(sps_country_data3, n = 3) ##   iso3 year     country       subregion NY.GDP.MKTP.CD SL.UEM.TOTL.ZS SM.POP.TOTL.ZS ## 1  SWE 2015      Sweden Northern Europe   5.051038e+11           7.43       16.76756 ## 2  CHE 2015 Switzerland  Western Europe   6.941182e+11           4.80       29.38669 ## 3  FRA 2015      France  Western Europe   2.439189e+12          10.35       12.08848"},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"external","dir":"Articles","previous_headings":"3.  Prepare Your Own Country-Level Data","what":"3.3  Merge External Data sets","title":"Prepare Country-Level Variables","text":"Users can also merge external data set. example, 4 variables—proportion female, mean age, mean education, general support immigration—come European Social Survey data. illustration, included external data ess_data. First, strongly recommended standardize country names using ISO3 code. Users can easily R package countrycode.","code":"data(ess_data) head(ess_data, n = 3) ## # A tibble: 3 × 5 ## # Groups:   country [3] ##   country        female   age education support_imm ##   <chr>           <dbl> <dbl>     <dbl>       <dbl> ## 1 Austria         0.509  49.5      2.33        2.95 ## 2 Belgium         0.492  47.5      2.74        3.13 ## 3 Czech Republic  0.529  46.7      2.68        2.28 library(countrycode) ess_data$iso3 <- countrycode(sourcevar = ess_data$country,                               origin = \"country.name\", destination = \"iso3c\") sps_country_data4 <- merge(sps_country_data3,                             ess_data[, c('iso3', 'female', 'age', 'education', 'support_imm')],                             by = 'iso3',                            all.x = TRUE,                            sort = FALSE)"},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"summary","dir":"Articles","previous_headings":"3.  Prepare Your Own Country-Level Data","what":"3.4  Check Data","title":"Prepare Country-Level Variables","text":"Users can run simple descriptive analyses examine distribution missing values. function desc_stat returns simple descriptive statistics number missing entries year data set. Character factor variables automatically binarized obtain descriptive statistics: list object desc returns descriptive summary variable data set, whereas miss returns total counts missing values (.e., number missing countries) year data set. years user interested using contains lot missing values, suggest imputing missing values using impute_var function R package spsR. Please see Handle Missing Data.","code":"check_missing(data = sps_country_data4[, !colnames(sps_country_data4) %in% c('iso3', 'country')],                       id_time = 'year') ##  ## ------------------------- ##  Descriptive Summary ## ------------------------- ##  ##                     variable         mean        stdev          min          p10          p25          p50          p75          p90          max  n ## 1                       year 2.015000e+03 0.000000e+00 2.015000e+03 2.015000e+03 2.015000e+03 2.015000e+03 2.015000e+03 2.015000e+03 2.015000e+03 15 ## 2             NY.GDP.MKTP.CD 9.456782e+11 1.067538e+12 4.310751e+10 2.066336e+11 2.972241e+11 4.623356e+11 9.808649e+11 2.736590e+12 3.357586e+12 15 ## 3             SL.UEM.TOTL.ZS 7.967333e+00 4.399676e+00 4.300000e+00 4.692000e+00 5.175000e+00 6.870000e+00 9.170000e+00 1.017400e+01 2.206000e+01 15 ## 4             SM.POP.TOTL.ZS 1.344696e+01 5.756509e+00 3.842226e+00 7.483406e+00 1.155432e+01 1.269024e+01 1.539799e+01 1.718646e+01 2.938669e+01 15 ## 5                     female 5.097057e-01 2.845523e-02 4.704025e-01 4.768593e-01 4.885782e-01 5.072974e-01 5.330339e-01 5.490700e-01 5.564516e-01 15 ## 6                        age 4.942636e+01 1.888551e+00 4.669628e+01 4.746564e+01 4.777149e+01 4.948649e+01 5.037790e+01 5.172993e+01 5.336549e+01 15 ## 7                  education 2.646158e+00 1.831415e-01 2.298802e+00 2.403758e+00 2.528171e+00 2.677203e+00 2.777084e+00 2.851173e+00 2.903405e+00 15 ## 8                support_imm 3.224444e+00 4.159755e-01 2.277581e+00 2.837090e+00 3.015142e+00 3.266733e+00 3.426971e+00 3.682870e+00 4.009691e+00 15 ## 9  subregion:Northern Europe 4.000000e-01 5.070926e-01 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 15 ## 10  subregion:Western Europe 4.000000e-01 5.070926e-01 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00 15 ## 11 subregion:Southern Europe 1.333333e-01 3.518658e-01 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 6.000000e-01 1.000000e+00 15 ## 12  subregion:Eastern Europe 6.666667e-02 2.581989e-01 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 1.000000e+00 15 ##  ##  ## ------------------------- ##  Missing Values ## ------------------------- ##  ##                     variable nmiss.total nmiss.2015 ## 1                       year           0          0 ## 2             NY.GDP.MKTP.CD           0          0 ## 3             SL.UEM.TOTL.ZS           0          0 ## 4             SM.POP.TOTL.ZS           0          0 ## 5                     female           0          0 ## 6                        age           0          0 ## 7                  education           0          0 ## 8                support_imm           0          0 ## 9  subregion:Northern Europe           0          0 ## 10  subregion:Western Europe           0          0 ## 11 subregion:Southern Europe           0          0 ## 12  subregion:Eastern Europe           0          0"},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"clean","dir":"Articles","previous_headings":"3.  Prepare Your Own Country-Level Data","what":"3.5  Clean Data for sps()","title":"Prepare Country-Level Variables","text":"Finally, clean data function sps(). First, need informative row names column names data. Second, can use clean_for_sps prepare data function sps(). function automatically (1) binarizes non-numeric variables (2) standardizes numeric variables (means zero standard deviations one) argument scale = TRUE. Please include variables diversify. example, users include site names X. X_Imm ready function sps().","code":"# row names row.names(sps_country_data4) <- sps_country_data4$country  # column names colnames(sps_country_data4)[5:11] <-    c('GDP', 'Unemployment', 'Immigration',      'Female', 'Age', 'Education', 'Immig_Support') column_for_sps <- c(\"subregion\",                      \"GDP\", \"Unemployment\", \"Immigration\",                      \"Female\", \"Age\", \"Education\", \"Immig_Support\")  X_Imm <- clean_for_sps(X = sps_country_data4[, column_for_sps], scale = TRUE) ## ## subregion is a non-numeric variable, and is binarized. ## ## Standardizing numeric variables to make each variable mean zero and standard deviation one. head(X_Imm, n = 3) ##                    GDP Unemployment Immigration     Female        Age  Education Immig_Support subregion_Eastern Europe subregion_Northern Europe subregion_Southern Europe subregion_Western Europe ## Sweden      -0.4127015   -0.1221302   0.5768431 -0.4083383  0.2240878  1.0770300     1.8877250                        0                         1                         0                        0 ## Switzerland -0.2356451   -0.7199015   2.7689923 -0.9268037 -0.7338824 -0.6687373     0.5298085                        0                         0                         0                        1 ## France       1.3990235    0.5415550  -0.2359897  0.3020230  0.2073008 -0.4071176    -0.4658665                        0                         0                         0                        1"},{"path":"http://naokiegami.com/spsR/articles/prepare_data.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Prepare Country-Level Variables","text":"Michael Coppedge et al. 2023. “V-Dem Dataset V13.” Varieties Democracy (V-Dem) Project. https://doi.org/10.23696/VDEMDS23. University Groningen. 2016. “World Languages.” University Groningen Open Data. www.resourcewatch.org.","code":""},{"path":[]},{"path":"http://naokiegami.com/spsR/articles/stratify_sps.html","id":"example","dir":"Articles","previous_headings":"","what":"Example","title":"Stratified SPS","text":"page, use Naumann et al. (2018) (data(X_Imm)) example. begin, make scale variables comparable standardizing continuous variables.","code":"library(spsR) data(\"X_Imm\") var_cont <-  c('GDP', 'Unemployment', 'Immigration',                 'Female', 'Age', 'Education', 'Immig_Support') X_Imm[, var_cont] <- scale(X_Imm[, var_cont])"},{"path":"http://naokiegami.com/spsR/articles/stratify_sps.html","id":"case1","dir":"Articles","previous_headings":"","what":"Case 1: Improve Diversity of Site-Level Variables","title":"Stratified SPS","text":"cases, researchers might want stratify variables make sure study sites satisfy certain conditions. example, users might want make sure select least one country low, middle, high GDP countries: least one country top 20 percentile GDP distribution least one country 40th 60th percentiles GDP distribution least one country bottom 20 percentile GDP distribution Users can enforce condition using stratify_sps(). Researchers can ensure select least 1 site GDP larger equal 80 percentile (quantile(X_Imm[, \"GDP\"], prob = c(0.8))). Similarly, researchers can ensure select least 1 site GDP 40th 60th percentile (quantile(X_Imm[, \"GDP\"], prob = c(0.4, 0.6))). Users can also ensure select least 1 site GDP smaller equal 20 percentile (quantile(X_Imm[, \"GDP\"], prob = c(0.2))). Arguments num_site: list two elements, e.g., list(\"least\", 1). argument specifies number sites satisfy condition specified . first element either least . second element integer. example, list(\"least\", 1) means stratify SPS select least 1 site satisfies condition (specified ). condition: list three elements, e.g., list(\"GDP\", \"larger equal \", 1). argument specifies conditions stratification. first element name site-level variable. second element either larger equal , smaller equal , . third element vector length 1 2. second element , third element vector two values. example, list(\"GDP\", \"larger equal \", 1) means stratify SPS select num_site sites GDP larger equal 1. Finally, users can combine different stratification one list supply function sps().","code":"q_80 <- quantile(X_Imm[, \"GDP\"], prob = c(0.8))  st_GDP_80 <-    stratify_sps(X = X_Imm,                 num_site = list(\"at least\", 1),                 condition = list(\"GDP\", \"larger than or equal to\", q_80)) ## 3 sites satisfy the specified `condition` and sps() will select at least 1 site from them. q_40_60 <- quantile(X_Imm[, \"GDP\"], prob = c(0.4, 0.6))           st_GDP_40_60 <-    stratify_sps(X = X_Imm,                 num_site = list(\"at least\", 1),                 condition = list(\"GDP\", \"between\", q_40_60)) ## 3 sites satisfy the specified `condition` and sps() will select at least 1 site from them. q_20 <- quantile(X_Imm[, \"GDP\"], prob = c(0.2))  st_GDP_20 <-     stratify_sps(X = X_Imm,                 num_site = list(\"at least\", 1),                 condition = list(\"GDP\", \"smaller than or equal to\", q_20)) ## 3 sites satisfy the specified `condition` and sps() will select at least 1 site from them. out_st <- sps(X = X_Imm, N_s = 6,                stratify = list(st_GDP_80, st_GDP_40_60, st_GDP_20)) ## Selecting Study Sites... out_st$selected_sites ## [1] \"Switzerland\" \"Czechia\"     \"Spain\"       \"France\"      \"Ireland\"     ## [6] \"Norway\""},{"path":"http://naokiegami.com/spsR/articles/stratify_sps.html","id":"stratify-each-variable","dir":"Articles","previous_headings":"Case 1: Improve Diversity of Site-Level Variables","what":"Stratify Each Variable","title":"Stratified SPS","text":"practice, often recommended add simple stratification every variable make sure can cover low high values dimension. example, standardizing variable, can make sure select least 1 site 0.5 standard deviation least 1 site −0.5 standard deviation.","code":"st_large <- st_small <- list() for(v in 1:7){ st_large[[v]] <- stratify_sps(X = X_Imm,                                num_site = list(\"at least\", 1),                                condition = list(colnames(X_Imm)[v], \"larger than or equal to\", 0.5)) st_small[[v]] <- stratify_sps(X = X_Imm,                                num_site = list(\"at least\", 1),                                condition = list(colnames(X_Imm)[v], \"smaller than or equal to\", -0.5)) } st_combined <- c(st_large, st_small) out_st <- sps(X = X_Imm, N_s = 6, stratify = st_combined) ## Selecting Study Sites... out_st$selected_sites ## [1] \"Switzerland\" \"Czechia\"     \"Germany\"     \"Denmark\"     \"Spain\"       ## [6] \"Netherlands\""},{"path":"http://naokiegami.com/spsR/articles/stratify_sps.html","id":"case2","dir":"Articles","previous_headings":"","what":"Case 2: Select Sites from Different Subgroups","title":"Stratified SPS","text":"often useful select sites different subgroups. example, users might want make sure select least one country 4 sub-regions Europe. following code ensures select least 1 site countries Northern Europe = 1. Similarly, following codes ensure select least 1 site countries Eastern Europe = 1, Western Europe = 1 Southern Europe = 1, respectively. Finally, users combine one list supply function sps().","code":"st_NE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Northern Europe\", \"larger than or equal to\", 1)) ## 6 sites satisfy the specified `condition` and sps() will select at least 1 site from them. st_EE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Eastern Europe\", \"larger than or equal to\", 1)) ## 1 site satisfies the specified `condition` and sps() will select at least 1 site from them. st_WE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Western Europe\", \"larger than or equal to\", 1)) ## 6 sites satisfy the specified `condition` and sps() will select at least 1 site from them. st_SE <-    stratify_sps(X=X_Imm,                 num_site=list(\"at least\", 1),                 condition=list(\"Southern Europe\", \"larger than or equal to\", 1)) ## 2 sites satisfy the specified `condition` and sps() will select at least 1 site from them. out_region <- sps(X = X_Imm,                    N_s = 6,                    stratify = list(st_NE, st_EE, st_WE, st_SE)) ## Selecting Study Sites... out_region$selected_sites ## [1] \"Switzerland\" \"Czechia\"     \"Germany\"     \"Denmark\"     \"Spain\"       ## [6] \"Netherlands\""},{"path":"http://naokiegami.com/spsR/articles/stratify_sps.html","id":"case3","dir":"Articles","previous_headings":"","what":"Case 3: Always Include or Always Exclude","title":"Stratified SPS","text":"cases, researchers might want always include always exclude certain sites. Let’s start cases always include certain sites. Users might want conduct studies certain sites, example, sites substantively important provide “hard tests” given theory. Suppose users always want include “Sweden” one study sites. , users can explicitly incorporate constraint follows. cases, researchers might want always exclude certain sites. example, users might able conduct studies certain sites survey firms offer service certain countries. Suppose users always want exclude “Denmark” “Spain” study sites. , users can explicitly incorporate constraint follows. course, users can incorporate constraints together.","code":"out <- sps(X = X_Imm, N_s = 6, site_include = c(\"Sweden\")) ## Selecting Study Sites... out$selected_sites ## [1] \"Switzerland\" \"Czechia\"     \"Spain\"       \"France\"      \"Ireland\"     ## [6] \"Sweden\" out <- sps(X = X_Imm, N_s = 6, site_exclude = c(\"Denmark\", \"Spain\")) ## Selecting Study Sites... out$selected_sites ## [1] \"Switzerland\"    \"Czechia\"        \"France\"         \"United Kingdom\" ## [5] \"Ireland\"        \"Norway\" out <- sps(X = X_Imm, N_s = 6,             site_include = c(\"Sweden\"),             site_exclude = c(\"Denmark\", \"Spain\")) ## Selecting Study Sites... out$selected_sites ## [1] \"Belgium\"     \"Switzerland\" \"Czechia\"     \"France\"      \"Ireland\"     ## [6] \"Sweden\""},{"path":"http://naokiegami.com/spsR/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Naoki Egami. Maintainer, author. Diana Da Lee. Author.","code":""},{"path":"http://naokiegami.com/spsR/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Egami N, Da Lee D (2023). spsR: Synthetic Purposive Sampling. R package version 0.1.0, http://naokiegami.com/spsR/.","code":"@Manual{,   title = {spsR: Synthetic Purposive Sampling},   author = {Naoki Egami and Diana {Da In Lee}},   year = {2023},   note = {R package version 0.1.0},   url = {http://naokiegami.com/spsR/}, }"},{"path":"http://naokiegami.com/spsR/index.html","id":"spsr-synthetic-purposive-sampling","dir":"","previous_headings":"","what":"spsR: Synthetic Purposive Sampling","title":"Synthetic Purposive Sampling ","text":"Description: R package spsR implements Synthetic Purposive Sampling (SPS) allows users select diverse study sites external validity, developed Egami Lee (2023+). Authors: Naoki Egami (Maintainer) Diana Da Lee Reference: Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling.","code":""},{"path":"http://naokiegami.com/spsR/index.html","id":"overview-of-the-website","dir":"","previous_headings":"spsR: Synthetic Purposive Sampling","what":"Overview of the Website","title":"Synthetic Purposive Sampling ","text":"Please start Get Started Page. page sufficient understanding basic use package.  provide detailed practical guides Practical Guides. Include (1) step--step instructions, (2) answers frequently asked questions, (3) suggestions data collection.  methodological details, please read Egami Lee (2023+).  happy receive questions suggestions R package spsR.  Please reach Naoki (naoki.egami@columbia.edu) Diana (dl2860@columbia.edu).","code":""},{"path":"http://naokiegami.com/spsR/index.html","id":"installation-instructions","dir":"","previous_headings":"spsR: Synthetic Purposive Sampling","what":"Installation Instructions","title":"Synthetic Purposive Sampling ","text":"can install recent development version using devtools package. First install devtools using following code. Note : , load devtools use function install_github() install spsR:","code":"if(!require(devtools)) install.packages(\"devtools\") library(devtools) install_github(\"naoki-egami/spsR\", dependencies = TRUE)"},{"path":"http://naokiegami.com/spsR/reference/X_Imm.html","id":null,"dir":"Reference","previous_headings":"","what":"Site-Level Variables for Naumann et al. (2018) — X_Imm","title":"Site-Level Variables for Naumann et al. (2018) — X_Imm","text":"Site-Level Variables Naumann et al. (2018)","code":""},{"path":"http://naokiegami.com/spsR/reference/X_Imm.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Site-Level Variables for Naumann et al. (2018) — X_Imm","text":"data","code":""},{"path":"http://naokiegami.com/spsR/reference/clean_for_sps.html","id":null,"dir":"Reference","previous_headings":"","what":"Clean data for function sps() — clean_for_sps","title":"Clean data for function sps() — clean_for_sps","text":"Clean data function sps()","code":""},{"path":"http://naokiegami.com/spsR/reference/clean_for_sps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Clean data for function sps() — clean_for_sps","text":"","code":"clean_for_sps(X, scale = TRUE)"},{"path":"http://naokiegami.com/spsR/reference/clean_for_sps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Clean data for function sps() — clean_for_sps","text":"X Site-level variables target population sites. Row names names sites. X contain missing data. scale TRUE FALSE. Whether standardize numeric variables make variable mean zero standard deviation one.","code":""},{"path":"http://naokiegami.com/spsR/reference/clean_for_sps.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Clean data for function sps() — clean_for_sps","text":"clean_for_sps returns object matrix class, supply sps().  X: Site-level variables target population sites.","code":""},{"path":"http://naokiegami.com/spsR/reference/clean_for_sps.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Clean data for function sps() — clean_for_sps","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/exp_estimate_Imm_selected.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimated Causal Effects for Selected Study Sites (data from Naumann et al. (2018)) — exp_estimate_Imm_selected","title":"Estimated Causal Effects for Selected Study Sites (data from Naumann et al. (2018)) — exp_estimate_Imm_selected","text":"Estimated Causal Effects Selected Study Sites (data Naumann et al. (2018))","code":""},{"path":"http://naokiegami.com/spsR/reference/exp_estimate_Imm_selected.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Estimated Causal Effects for Selected Study Sites (data from Naumann et al. (2018)) — exp_estimate_Imm_selected","text":"data","code":""},{"path":"http://naokiegami.com/spsR/reference/plot.sps_estimator.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot function for sps_estimator — plot.sps_estimator","title":"Plot function for sps_estimator — plot.sps_estimator","text":"Plot function sps_estimator","code":""},{"path":"http://naokiegami.com/spsR/reference/plot.sps_estimator.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot function for sps_estimator — plot.sps_estimator","text":"","code":"# S3 method for sps_estimator plot(x, ...)"},{"path":"http://naokiegami.com/spsR/reference/plot.sps_estimator.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot function for sps_estimator — plot.sps_estimator","text":"x Output function sps_estimator() ... arguments.","code":""},{"path":"http://naokiegami.com/spsR/reference/plot.sps_estimator.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot function for sps_estimator — plot.sps_estimator","text":"sps_plot_est plots estimates 95","code":""},{"path":"http://naokiegami.com/spsR/reference/plot.sps_estimator.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Plot function for sps_estimator — plot.sps_estimator","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps.html","id":null,"dir":"Reference","previous_headings":"","what":"Synthetic Purposive Sampling: Site Selection for External Validity — sps","title":"Synthetic Purposive Sampling: Site Selection for External Validity — sps","text":"Synthetic Purposive Sampling: Site Selection External Validity","code":""},{"path":"http://naokiegami.com/spsR/reference/sps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Synthetic Purposive Sampling: Site Selection for External Validity — sps","text":"","code":"sps(   X,   N_s,   stratify = NULL,   site_include = NULL,   site_exclude = NULL,   lambda = c(1, 1, 0),   seed = 1234 )"},{"path":"http://naokiegami.com/spsR/reference/sps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synthetic Purposive Sampling: Site Selection for External Validity — sps","text":"X Site-level variables target population sites. Row names names sites. X contain missing data. N_s Number study sites selected. stratify (Optional. Default = NULL) Output function stratify_sps(). argument helps users incorporate practical logistical constraints. See examples http://naokiegami.com/spsR/articles/stratify_sps.html site_include (Optional. Default = NULL) Names sites users want always include (already selected). site_exclude (Optional. Default = NULL) Names sites users want always exclude. lambda Values tuning parameters. users want change balance three parts objective function, can change lambda. Default values c(1, 1, 0). Users want fine-tune tuning parameters, please see methodological details Egami Lee (2023+) (https://naokiegami.com/paper/sps.pdf). seed Numeric. seed used internally. Default = 1234.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Synthetic Purposive Sampling: Site Selection for External Validity — sps","text":"sps returns object sps class.  selected_sites: Names sites SPS algorithm selected. W: Estimated weights approximate non-selected sites using selected sites. W used subsequent estimation average-site ATE. obj: Estimated values objective function, separately three parts. internal: Objects useful internal use function.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Synthetic Purposive Sampling: Site Selection for External Validity — sps","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_cv.html","id":null,"dir":"Reference","previous_headings":"","what":"Site-level Cross-Validation for Synthetic Purposive Sampling — sps_cv","title":"Site-level Cross-Validation for Synthetic Purposive Sampling — sps_cv","text":"Site-level Cross-Validation Synthetic Purposive Sampling","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_cv.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Site-level Cross-Validation for Synthetic Purposive Sampling — sps_cv","text":"","code":"sps_cv(   out = NULL,   estimates_selected = NULL,   K = 2,   max_iter = 100,   seed = 1234 )"},{"path":"http://naokiegami.com/spsR/reference/sps_cv.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Site-level Cross-Validation for Synthetic Purposive Sampling — sps_cv","text":"Output function sps() estimates_selected data.frame two columns: first column represents estimates site-specific ATEs selected sites second column represents corresponding standard error. number rows equal number selected sites rownames(estimates_selected) names selected sites. K (Default = 2) Fold cross-validation. max_iter (Default = 100) many times function repeats K-fold cross-validation. seed Numeric. seed used internally. Default = 1234.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_cv.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Site-level Cross-Validation for Synthetic Purposive Sampling — sps_cv","text":"sps_cv returns two objects.  p_value: P-value null hypothesis average-site ATE among non-selected sites equal weighted average estimator average-site ATE based site-specific ATE estimates selected sites. internal: Objects useful internal use function.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_cv.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Site-level Cross-Validation for Synthetic Purposive Sampling — sps_cv","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_estimator.html","id":null,"dir":"Reference","previous_headings":"","what":"Synthetic Purposive Sampling Estimator for the Average-Site ATE — sps_estimator","title":"Synthetic Purposive Sampling Estimator for the Average-Site ATE — sps_estimator","text":"Synthetic Purposive Sampling Estimator Average-Site ATE","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_estimator.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Synthetic Purposive Sampling Estimator for the Average-Site ATE — sps_estimator","text":"","code":"sps_estimator(   out = NULL,   estimates_selected = NULL,   X = NULL,   selected_sites = NULL )"},{"path":"http://naokiegami.com/spsR/reference/sps_estimator.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Synthetic Purposive Sampling Estimator for the Average-Site ATE — sps_estimator","text":"Output function sps() estimates_selected data.frame two columns: first column represents estimates site-specific ATEs selected sites second column represents corresponding standard error. number rows equal number selected sites rownames(estimates_selected) names selected sites. X (Optional. Use sites selected based sps(). Default = NULL) Site-level variables target population sites. Row names names sites. selected_sites (Optional. Use sites selected based sps(). Default = NULL) Names sites users selected. subset rownames(X).","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_estimator.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Synthetic Purposive Sampling Estimator for the Average-Site ATE — sps_estimator","text":"sps_estimator returns object sps_estimator class.  average_site_ATE: estimate average-site ATE corresponding standard error. site_specific_ATE: Estimates standard errors site-specific ATEs non-selected sites. bet_se: Estimated -site standard errors.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_estimator.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Synthetic Purposive Sampling Estimator for the Average-Site ATE — sps_estimator","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_plot.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot function for sps — sps_plot","title":"Plot function for sps — sps_plot","text":"Plot function sps","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_plot.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot function for sps — sps_plot","text":"","code":"sps_plot(out, title = NULL, columns = NULL, before_selection = FALSE, X = NULL)"},{"path":"http://naokiegami.com/spsR/reference/sps_plot.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot function for sps — sps_plot","text":"Output function sps() title Title plot columns (Optional. Default = NULL) Names columns users want visualize. NULL, function plots every column. before_selection Logical (TRUE FALSE. Default = FALSE). FALSE, function compare selected non-selected sites. TRUE, function simply visualizes distribution site-level variables target population sites. X (Optional. Use before_selection = TRUE.) Site-level variables target population sites.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_plot.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot function for sps — sps_plot","text":"sps_plot visualizes distribution site-level variables.","code":""},{"path":"http://naokiegami.com/spsR/reference/sps_plot.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Plot function for sps — sps_plot","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/stratify_sps.html","id":null,"dir":"Reference","previous_headings":"","what":"Stratification for Synthetic Purposive Sampling — stratify_sps","title":"Stratification for Synthetic Purposive Sampling — stratify_sps","text":"Stratification Synthetic Purposive Sampling","code":""},{"path":"http://naokiegami.com/spsR/reference/stratify_sps.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Stratification for Synthetic Purposive Sampling — stratify_sps","text":"","code":"stratify_sps(X, num_site = NULL, condition = NULL)"},{"path":"http://naokiegami.com/spsR/reference/stratify_sps.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Stratification for Synthetic Purposive Sampling — stratify_sps","text":"X Site-level variables target population sites. Row names names sites. X contain missing data. num_site list two elements, e.g., list(\"least\", 1). argument specifies number sites satisfy condition specified . first element either least . second element integer. example, list(\"least\", 1) means stratify SPS select *least 1* site satisfies condition (specified ). condition list three elements, e.g., list(\"GDP\", \"larger equal \", 1). argument specifies conditions stratification. first element name site-level variable. second element either larger equal , smaller equal , . third element vector length 1 2. second element , third element vector two values. example, list(\"GDP\", \"larger equal \", 1) means stratify SPS select num_site sites *GDP larger equal 1*.","code":""},{"path":"http://naokiegami.com/spsR/reference/stratify_sps.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Stratification for Synthetic Purposive Sampling — stratify_sps","text":"stratify_sps returns object stratify_sps class, supply sps().  C: matrix left-hand side linear constraints. number columns number sites target population (=nrow(X)) number rows number constraints. c0: vector right-hand side linear constraints. length number constraints.","code":""},{"path":"http://naokiegami.com/spsR/reference/stratify_sps.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Stratification for Synthetic Purposive Sampling — stratify_sps","text":"Egami Lee. (2023+). Designing Multi-Context Studies External Validity: Site Selection via Synthetic Purposive Sampling. Available https://naokiegami.com/paper/sps.pdf.","code":""},{"path":"http://naokiegami.com/spsR/reference/summary.sps_estimator.html","id":null,"dir":"Reference","previous_headings":"","what":"Summary function — summary.sps_estimator","title":"Summary function — summary.sps_estimator","text":"Summary function","code":""},{"path":"http://naokiegami.com/spsR/reference/summary.sps_estimator.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summary function — summary.sps_estimator","text":"","code":"# S3 method for sps_estimator summary(object, ci = 0.95, ...)"},{"path":"http://naokiegami.com/spsR/reference/summary.sps_estimator.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summary function — summary.sps_estimator","text":"object Output sps_estimator(). ci (Default = 0.95.) Coverage estimated confidence intervals. ... arguments.","code":""}]
