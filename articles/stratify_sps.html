<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spsR">
<title>Stratified SPS • spsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stratified SPS">
<meta property="og:description" content="spsR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/intro.html">Get Started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/practical_guides.html">Practical Guides</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-more">More</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-more">
    <a class="dropdown-item" href="../articles/prepare_data.html">1. Prepare Country-Level Variables</a>
    <a class="dropdown-item" href="../articles/missing_data.html">2. Handle Missing Data</a>
    <a class="dropdown-item" href="../articles/stratify_sps.html">3. Stratified SPS</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Stratified SPS</h1>
            
      
      
      <div class="d-none name"><code>stratify_sps.Rmd</code></div>
    </div>

    
    
<p><br></p>
<p class="h5">
<strong>On this page, we explain how to use <code><a href="../reference/stratify_sps.html">stratify_sps()</a></code>
to incorporate various practical constraints and domain knowledge to
<code><a href="../reference/sps.html">sps()</a></code>.</strong>
</p>
<br><div class="card bg-light mb-3">
<div class="card-header">
<strong>Table of Contents</strong>
</div>
<div class="card-body">
<ul>
<li><p><a href="#case2"><strong>Case 1: Improve Diversity of Site-Level
Variables</strong></a>: <br> How can we use stratification to improve
diversity?</p></li>
<li><p><a href="#case3"><strong>Case 2: Select Sites from Different
Subgroups</strong></a>: <br> How can we use stratification to select
sites from different subgroups?</p></li>
<li><p><a href="#case1"><strong>Case 3: Always Include or Always
Exclude</strong></a>: <br> How can we always include or exclude certain
sites?</p></li>
</ul>
</div>
</div>
<p><br></p>
<div class="section level4">
<h4 id="example">
<span style="color:#3366CC">Example</span><a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<p>On this page, we use Naumann et al. (2018) (<code>data(X_Imm)</code>)
as an example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://naokiegami.com/spsR/">spsR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"X_Imm"</span><span class="op">)</span></span></code></pre></div>
<p>Before we begin, we make the scale of variables comparable by
standardizing continuous variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_cont</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'GDP'</span>, <span class="st">'Unemployment'</span>, <span class="st">'Immigration'</span>, </span>
<span>               <span class="st">'Female'</span>, <span class="st">'Age'</span>, <span class="st">'Education'</span>, <span class="st">'Immig_Support'</span><span class="op">)</span></span>
<span><span class="va">X_Imm</span><span class="op">[</span>, <span class="va">var_cont</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">[</span>, <span class="va">var_cont</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="case1">
<span style="color:#3366CC"><strong>Case 1: Improve Diversity of
Site-Level Variables</strong></span><a class="anchor" aria-label="anchor" href="#case1"></a>
</h3>
<p class="lh-lg">
</p>
<p>In some cases, researchers might want to stratify some variables to
make sure that study sites satisfy certain conditions.</p>
<p>For example, users might want to make sure that we select at least
one country from low, middle, and high GDP countries:</p>
<ul>
<li>at least one country from the top 20 percentile of the GDP
distribution</li>
<li>at least one country between 40th and 60th percentiles of the GDP
distribution</li>
<li>at least one country from the bottom 20 percentile of the GDP
distribution</li>
</ul>
<p>Users can enforce this condition using
<code>stratify_sps().</code></p>
<p>Researchers can ensure to select <code>at least</code> <code>1</code>
site that have <code>GDP</code> larger than or equal to the 80
percentile (<code>quantile(X_Imm[, "GDP"], prob = c(0.8))</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_80</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">[</span>, <span class="st">"GDP"</span><span class="op">]</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_GDP_80</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, </span>
<span>               num_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"GDP"</span>, <span class="st">"larger than or equal to"</span>, <span class="va">q_80</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 3 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<p>Similarly, researchers can ensure to select <code>at least</code>
<code>1</code> site that have <code>GDP</code> between the 40th and 60th
percentile
(<code>quantile(X_Imm[, "GDP"], prob = c(0.4, 0.6))</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_40_60</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">[</span>, <span class="st">"GDP"</span><span class="op">]</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></span>
<span>         </span>
<span><span class="va">st_GDP_40_60</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, </span>
<span>               num_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"GDP"</span>, <span class="st">"between"</span>, <span class="va">q_40_60</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 3 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<p>Users can also ensure to select <code>at least</code> <code>1</code>
site that have <code>GDP</code> smaller than or equal to the 20
percentile (<code>quantile(X_Imm[, "GDP"], prob = c(0.2))</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q_20</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">[</span>, <span class="st">"GDP"</span><span class="op">]</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">st_GDP_20</span> <span class="op">&lt;-</span>  </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, </span>
<span>               num_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"GDP"</span>, <span class="st">"smaller than or equal to"</span>, <span class="va">q_20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 3 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<p><strong>Arguments</strong></p>
<ul>
<li><p><code>num_site</code>: A list of two elements, e.g.,
<code>list("at least", 1)</code>. This argument specifies the number of
sites that should satisfy <code>condition</code> specified below. The
first element should be either <code>at least</code> or
<code>at most</code>. The second element is integer. For example,
<code>list("at least", 1)</code> means that we stratify SPS such that we
select <em>at least 1</em> site that satisfies <code>condition</code>
(specified below).</p></li>
<li><p><code>condition</code>: A list of three elements, e.g.,
<code>list("GDP", "larger than or equal to", 1)</code>. This argument
specifies conditions for stratification. The first element should be a
name of a site-level variable. The second element should be either
<code>larger than or equal to</code>,
<code>smaller than or equal to</code>, or <code>between</code>. The
third element is a vector of length 1 or 2. When the second element is
<code>between</code>, the third element should be a vector of two
values. For example,
<code>list("GDP", "larger than or equal to", 1)</code> means that we
stratify SPS such that we select <code>num_site</code> sites that have
<em>GDP larger than or equal to 1</em>.</p></li>
</ul>
<p>Finally, users can combine these different stratification into one
<code>list</code> and supply it to function <code><a href="../reference/sps.html">sps()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, N_s <span class="op">=</span> <span class="fl">6</span>, </span>
<span>              stratify <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">st_GDP_80</span>, <span class="va">st_GDP_40_60</span>, <span class="va">st_GDP_20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Selecting Study Sites...</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_st</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Switzerland" "Czechia"     "Spain"       "France"      "Ireland"    </span></span>
<span><span class="co">## [6] "Norway"</span></span></code></pre>
<div class="section level5">
<h5 id="stratify-each-variable">
<span style="color:#3366CC">Stratify Each Variable</span><a class="anchor" aria-label="anchor" href="#stratify-each-variable"></a>
</h5>
<p>In practice, it is often recommended to add simple stratification to
every variable to make sure that we can cover low and high values in
each dimension. For example, after standardizing each variable, we can
make sure to select at least 1 site above 0.5 standard deviation and at
least 1 site below −0.5 standard deviation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_large</span> <span class="op">&lt;-</span> <span class="va">st_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="va">st_large</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, </span>
<span>                              num_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                              condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">)</span><span class="op">[</span><span class="va">v</span><span class="op">]</span>, <span class="st">"larger than or equal to"</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">st_small</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, </span>
<span>                              num_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                              condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">)</span><span class="op">[</span><span class="va">v</span><span class="op">]</span>, <span class="st">"smaller than or equal to"</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 3 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 7 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 2 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 6 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 3 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 3 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 5 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 6 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 4 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 6 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 6 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 5 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 4 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span>
<span><span class="co">## There are 4 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_combined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">st_large</span>, <span class="va">st_small</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_st</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, N_s <span class="op">=</span> <span class="fl">6</span>, stratify <span class="op">=</span> <span class="va">st_combined</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Selecting Study Sites...</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_st</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Switzerland" "Czechia"     "Germany"     "Denmark"     "Spain"      </span></span>
<span><span class="co">## [6] "Netherlands"</span></span></code></pre>
<p><br></p>
</div>
</div>
<div class="section level3">
<h3 id="case2">
<span style="color:#3366CC"><strong>Case 2: Select Sites from
Different Subgroups</strong></span><a class="anchor" aria-label="anchor" href="#case2"></a>
</h3>
<p class="lh-lg">
</p>
<p>It is often useful to select sites from different subgroups. For
example, users might want to make sure that we select at least one
country from each of 4 sub-regions of Europe.</p>
<p>The following code ensures to select <code>at least</code>
<code>1</code> site from countries that have
<code>Northern Europe = 1</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_NE</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X_Imm</span>, </span>
<span>               num_site<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Northern Europe"</span>, <span class="st">"larger than or equal to"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 6 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<p>Similarly, the following codes ensure that we select
<code>at least</code> <code>1</code> site from countries that have
<code>Eastern Europe = 1</code>, <code>Western Europe = 1</code> and
<code>Southern Europe = 1</code>, respectively.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_EE</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X_Imm</span>, </span>
<span>               num_site<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Eastern Europe"</span>, <span class="st">"larger than or equal to"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 1 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_WE</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X_Imm</span>, </span>
<span>               num_site<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Western Europe"</span>, <span class="st">"larger than or equal to"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 6 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">st_SE</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/stratify_sps.html">stratify_sps</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X_Imm</span>, </span>
<span>               num_site<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"at least"</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>               condition<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Southern Europe"</span>, <span class="st">"larger than or equal to"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## There are 2 sites that satisfy the specified `condition` and sps() will select at least 1 sites from those.</span></span></code></pre>
<p>Finally, users combine them into one <code>list</code> and supply it
to function <code><a href="../reference/sps.html">sps()</a></code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, </span>
<span>                  N_s <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                  stratify <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">st_NE</span>, <span class="va">st_EE</span>, <span class="va">st_WE</span>, <span class="va">st_SE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Selecting Study Sites...</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_region</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Switzerland" "Czechia"     "Germany"     "Denmark"     "Spain"      </span></span>
<span><span class="co">## [6] "Netherlands"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="case3">
<span style="color:#3366CC"><strong>Case 3: Always Include or Always
Exclude</strong></span><a class="anchor" aria-label="anchor" href="#case3"></a>
</h3>
<p class="lh-lg">
</p>
<p>In some cases, researchers might want to always include or always
exclude certain sites.</p>
<p>Let’s start with cases when we always include certain sites. Users
might want to conduct studies in certain sites, for example, because
those sites are substantively important or provide “hard tests” for a
given theory.</p>
<p>Suppose users always want to include “Sweden” as one of study sites.
If so, users can explicitly incorporate this constraint as follows.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, N_s <span class="op">=</span> <span class="fl">6</span>, site_include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sweden"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Selecting Study Sites...</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Switzerland" "Czechia"     "Spain"       "France"      "Ireland"    </span></span>
<span><span class="co">## [6] "Sweden"</span></span></code></pre>
<p>In other cases, researchers might want to always exclude certain
sites. For example, users might not be able to conduct studies in
certain sites because survey firms do not offer service in certain
countries.</p>
<p>Suppose users always want to exclude “Denmark” and “Spain” from study
sites. If so, users can explicitly incorporate this constraint as
follows.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, N_s <span class="op">=</span> <span class="fl">6</span>, site_exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Denmark"</span>, <span class="st">"Spain"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Selecting Study Sites...</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Switzerland"    "Czechia"        "France"         "United Kingdom"</span></span>
<span><span class="co">## [5] "Ireland"        "Norway"</span></span></code></pre>
<p>Of course, users can incorporate both constraints together.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, N_s <span class="op">=</span> <span class="fl">6</span>, </span>
<span>           site_include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sweden"</span><span class="op">)</span>, </span>
<span>           site_exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Denmark"</span>, <span class="st">"Spain"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Selecting Study Sites...</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Belgium"     "Switzerland" "Czechia"     "France"      "Ireland"    </span></span>
<span><span class="co">## [6] "Sweden"</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Naoki Egami, Diana Da In Lee.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
