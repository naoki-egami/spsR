<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="spsR">
<title>Introduction to sps â€¢ spsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to sps">
<meta property="og:description" content="spsR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">spsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/intro.html">Get Started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/practical_guides.html">1. Practical Guides</a>
    <a class="dropdown-item" href="../articles/methods_guides.html">2. Methodological Guides</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/full_example.html">Full Example</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-more">More</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-more">
    <a class="dropdown-item" href="../articles/prepare_data.html">1. Prepare Site-level Variables</a>
    <a class="dropdown-item" href="../articles/missing_data.html">2. Handle Missing Data</a>
    <a class="dropdown-item" href="../articles/stratify_sps.html">3. Stratified SPS</a>
    <a class="dropdown-item" href="../articles/sps_estimator.html">4. SPS Estimator</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/faq.html">FAQ</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to sps</h1>
            
      
      
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>On this page, we provide the introduction to <code>sps</code> package
(5 minute read).</p>
<p>Specifically, we explain the two main functions.</p>
<ol style="list-style-type: decimal">
<li><p><code>sps</code>: Synthetic Purposive Sampling to select study
sites for multi-site causal studies.</p></li>
<li><p><code>sps_estimator</code>: Synthetic Purposive Sampling
Estimator to estimate the average-site average treatment effect (ATEs)
from multi-site causal studies.</p></li>
</ol>
<p><br></p>
</div>
<div class="section level3">
<h3 id="sps-site-selection">
<code>sps</code>: Site Selection<a class="anchor" aria-label="anchor" href="#sps-site-selection"></a>
</h3>
<p>We use a multi-country survey experiment on attitudes toward
immigrants (Naumann et al, 2018) as an example here.</p>
<p>In this example, we define 15 European countries as the population of
sites. As site-level variables, we consider 7 variables discussed in the
original paper: GDP, size of migrant population, unemployment rates,
general support for immigration, the proportion of females, the mean
age, and the mean income.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://naokiegami.com/spsR/">spsR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"X_Imm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 15  7</span></span></code></pre>
<p>In practice, it is recommended to standardize each variable to make
the scale of site-level variables comparable. That is, each variable has
the mean zero and the standard deviation one.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X_Imm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">X_Imm</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       GDP Immigration Unemp. Immi-Support Female    Age Education</span></span>
<span><span class="co">## NL  0.393      -0.252 -0.294        0.169  1.643  0.961    -0.011</span></span>
<span><span class="co">## SE  0.083       0.460 -0.144        1.888 -0.408  0.224     1.077</span></span>
<span><span class="co">## NO  2.214      -0.299 -1.003        1.018 -1.381 -1.038     1.405</span></span>
<span><span class="co">## FR -0.537      -0.173  0.201       -0.466  0.302  0.207    -0.407</span></span>
<span><span class="co">## DE  0.198       0.397 -0.667        1.158 -0.661  0.396     0.288</span></span>
<span><span class="co">## BE -0.084      -0.515 -0.074       -0.226 -0.615 -1.019     0.522</span></span></code></pre>
<p>Users can use <code>sps_plot()</code> to visualize the distribution
of site-level variables before site selection.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sps_plot</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, before_selection <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can then use <code>sps</code> to select diverse sites from the
population of sites. We will select 6 sites from 15 European countries
in this example.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: Given that the underlying optimization
problem is a mixed-integer problem, the function usually takes less than
30 secs to complete in typical problems in political science and related
social science fields (e.g., select 5 ~ 10 sites out of 15 ~ 30 sites).
If users want to select a larger number of sites from a larger
population of sites, it might take more time.&lt;/p&gt;"><sup>1</sup></a> We start with the basic version of
<code>sps</code> and illustrate refinements on different pages (e.g.,
the stratified SPS).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sps.html">sps</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_Imm</span>, N_s <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>In this example, <code>sps</code> selected the following 6 sites.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span><span class="op">$</span><span class="va">selected_sites</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "NO" "FR" "DE" "ES" "CH" "CZ"</span></span></code></pre>
<p>Users can investigate the selected sites visually. Red triangles
represent selected sites and black circles represent non-selected sites.
In the last row and the diagonal plots, users can see the marginal
distribution of each variable. All the remaining figures in the middle
show bivariate relationships between two variables.</p>
<p>We can see that selected sites successfully cover a wide range of
values in each site-level variable.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sps_plot</span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
<p>If necessary, users can refine site selection using
<em>stratification</em> to make sure selected sites satisfy certain
conditions. This stratification can help users to incorporate various
practical, logistical, and ethical constraints. Please see AAA.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="sps_estimator-estimate-the-average-site-ate">
<code>sps_estimator</code>: Estimate the Average-Site ATE<a class="anchor" aria-label="anchor" href="#sps_estimator-estimate-the-average-site-ate"></a>
</h3>
<p>We focus on a multi-site causal study where where researchers have
(experimental or observational) identification strategies for internal
validity within each site and researchers compare results across sites
for external validity. <code>sps_estimator</code> will aggregate
site-specific ATE estimates to estimate the average-site ATE.</p>
<p>Here, we use experimental estimates in selected 6 sites from Naumann
et al (2018). Users only need to obtain point estimates and standard
errors of the average treatment effects (ATEs) in each site.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"exp_estimate_Imm_selected"</span><span class="op">)</span></span>
<span><span class="va">exp_estimate_Imm_selected</span></span></code></pre></div>
<pre><code><span><span class="co">##     Estimate         se</span></span>
<span><span class="co">## NO 0.2685040 0.02555942</span></span>
<span><span class="co">## FR 0.2751970 0.02201039</span></span>
<span><span class="co">## DE 0.3362153 0.01635270</span></span>
<span><span class="co">## ES 0.2831690 0.02368973</span></span>
<span><span class="co">## CH 0.2857338 0.02715871</span></span>
<span><span class="co">## CZ 0.2210802 0.01993582</span></span></code></pre>
<p>We then aggregate these site-specific ATEs in selected sites to
estimate the average-site ATE.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps_est</span> <span class="op">&lt;-</span> <span class="fu">sps_estimator</span><span class="op">(</span>out <span class="op">=</span> <span class="va">out</span>, estimates_selected <span class="op">=</span> <span class="va">exp_estimate_Imm_selected</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sps_est</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##   Estimate Std. Error CI Lower  CI Upper p value    </span></span>
<span><span class="co">##  0.2816856  0.0178333 0.246733 0.3166383       0 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>Finally, users can use site-level cross-validation to assess the
influence of unobserved moderators. In particular, users can randomly
choose half of the selected sites as if they were unobserved
non-selected sites and predict the average ATE of those non-selected
sites based on the remaining selected sites. The null hypothesis is that
the predicted ATEs are the same as the observed ATEs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sps_cv_out</span> <span class="op">&lt;-</span> <span class="fu">sps_cv</span><span class="op">(</span>out <span class="op">=</span> <span class="va">out</span>, estimates_selected <span class="op">=</span> <span class="va">exp_estimate_Imm_selected</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sps_cv_out</span><span class="op">$</span><span class="va">p_value</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.97</span></span></code></pre>
<p>In this example, an estimated p-value is 0.97, and we do not find
evidence for the bias due to unobserved moderators.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Naoki Egami, Diana Da In Lee.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
